<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 2</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: system-ui; padding: 16px; background:#f2f2f2; }
.card {
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:10px;
}
.exercise { font-weight:600; margin-top:6px; }
.set { font-size:14px; margin-left:12px; }
.err { color:red; }
</style>
</head>
<body>

<h2>Step 2 ‚Äî –ò—Å—Ç–æ—Ä–∏—è</h2>
<div id="app">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
const API = "https://ula-conductorial-vagrantly.ngrok-free.dev";
const app = document.getElementById("app");

const tg = Telegram.WebApp;
const telegramId = tg.initDataUnsafe?.user?.id;

if (!telegramId) {
  app.innerHTML = "<div class='err'>Telegram ID –Ω–µ –Ω–∞–π–¥–µ–Ω</div>";
  throw new Error("No telegram id");
}

fetch(`${API}/workouts/${telegramId}`)
  .then(r => r.json())
  .then(data => {
    if (!Array.isArray(data) || data.length === 0) {
      app.innerHTML = "–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ—Ç";
      return;
    }

    app.innerHTML = "";
    data.forEach(w => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `<b>üìÖ ${w.workout_date}</b>`;

      w.info.exercises.forEach(ex => {
        card.innerHTML += `<div class="exercise">${ex.name}</div>`;
        ex.sets.forEach(s => {
          card.innerHTML += `<div class="set">${s.weight} –∫–≥ √ó ${s.reps}</div>`;
        });
      });

      app.appendChild(card);
    });
  })
  .catch(e => {
    app.innerHTML = "<div class='err'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>";
    console.error(e);
  });
</script>

</body>
</html>
