<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h2>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
<ul id="workouts"></ul>

<button onclick="addWorkout()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>

<script>
const tg = Telegram.WebApp;
tg.ready();

const userId = tg.initDataUnsafe.user.id;
const API = "https://fitness-tracker-backend-dhos.onrender.com";

async function loadWorkouts() {
    const res = await fetch(`${API}/workouts/${userId}`);
    const data = await res.json();

    const list = document.getElementById("workouts");
    list.innerHTML = "";

    data.forEach(w => {
        const li = document.createElement("li");
        li.innerHTML = `
            ${new Date(w.workout_date).toLocaleDateString()}
            ‚Äî ${w.workout_type_name}
            <button onclick="deleteWorkout(${w.id})">‚ùå</button>
        `;
        list.appendChild(li);
    });
}

async function addWorkout() {
    await fetch(`${API}/workouts/${userId}`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            workout_type_id: 1,
            workout_date: new Date().toISOString(),
            info: "–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞"
        })
    });
    loadWorkouts();
}

async function deleteWorkout(id) {
    await fetch(`${API}/workouts/${id}`, { method: "DELETE" });
    loadWorkouts();
}

loadWorkouts();
</script>

</body>
</html>
