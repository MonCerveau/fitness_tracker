<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 2 Debug</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  font-family: system-ui;
  background: #f2f2f2;
  padding: 16px;
}
.box {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}
.ok { color: green; }
.err { color: red; }
.code {
  background: #111;
  color: #0f0;
  padding: 10px;
  font-family: monospace;
  font-size: 12px;
  border-radius: 8px;
  white-space: pre-wrap;
}
</style>
</head>
<body>

<h3>üß™ Step 2 ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API</h3>

<div class="box" id="tgBox">Telegram: ...</div>
<div class="box" id="urlBox">URL: ...</div>
<div class="box" id="statusBox">–°—Ç–∞—Ç—É—Å: ...</div>
<div class="box">
  <b>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:</b>
  <div class="code" id="responseBox">...</div>
</div>

<script>
const tgBox = document.getElementById("tgBox");
const urlBox = document.getElementById("urlBox");
const statusBox = document.getElementById("statusBox");
const responseBox = document.getElementById("responseBox");

/* ===== TELEGRAM ===== */
if (!window.Telegram || !Telegram.WebApp) {
  tgBox.innerHTML = "<span class='err'>‚ùå Telegram WebApp API –Ω–µ –Ω–∞–π–¥–µ–Ω</span>";
  throw new Error("No Telegram");
}

const telegramId = Telegram.WebApp.initDataUnsafe?.user?.id;

if (!telegramId) {
  tgBox.innerHTML = "<span class='err'>‚ùå Telegram ID –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω</span>";
  throw new Error("No telegram id");
}

tgBox.innerHTML = `<span class='ok'>‚úÖ Telegram ID:</span> ${telegramId}`;

/* ===== API ===== */
const API_URL = "https://ula-conductorial-vagrantly.ngrok-free.dev?ngrok-skip-browser-warning=1"; // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò
const fullUrl = `${API_URL}/workouts/${telegramId}`;

urlBox.innerHTML = `<b>GET:</b> ${fullUrl}`;

/* ===== FETCH ===== */
fetch(fullUrl, {
  headers: {
    "ngrok-skip-browser-warning": "true"
  }
})
  .then(r => {
    statusBox.innerHTML = `<b>HTTP —Å—Ç–∞—Ç—É—Å:</b> ${r.status}`;
    return r.text().then(t => ({ status: r.status, text: t }));
  })
  .then(({ status, text }) => {
    responseBox.textContent = text;
  })
  .catch(err => {
    responseBox.textContent = err.message;
  });
</script>

</body>
</html>


